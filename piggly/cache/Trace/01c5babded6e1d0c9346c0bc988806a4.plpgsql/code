DECLARE
    have       ALIAS FOR $1;
    want       ALIAS FOR $2;
    have_rec   RECORD;
    want_rec   RECORD;
    have_found BOOLEAN;
    want_found BOOLEAN;
    rownum     INTEGER := 1;
    err_msg    text := 'details not available in pg <= 9.1';
BEGIN
    perform public.piggly_branch($PIGGLY$8de39917e72172d2$PIGGLY$);
    FETCH have INTO have_rec;
    have_found := FOUND;
    FETCH want INTO want_rec;
    want_found := FOUND;
    WHILE public.piggly_cond($PIGGLY$36f01abd54846042$PIGGLY$, (have_found OR want_found)) LOOP
        perform public.piggly_branch($PIGGLY$eb095f0b616a3dff$PIGGLY$);
        IF public.piggly_cond($PIGGLY$f98a0bf4821c3766$PIGGLY$, (have_rec IS DISTINCT FROM want_rec OR have_found <> want_found)) THEN
            perform public.piggly_branch($PIGGLY$648fd0d826aec8c7$PIGGLY$);
            perform public.piggly_branch($PIGGLY$37ba5d1b0365da49$PIGGLY$);RETURN ok( false, $3 ) || E'\n' || diag(
                '    Results differ beginning at row ' || rownum || E':\n' ||
                '        have: ' || CASE WHEN have_found THEN have_rec::text ELSE 'NULL' END || E'\n' ||
                '        want: ' || CASE WHEN want_found THEN want_rec::text ELSE 'NULL' END
            );
        END IF;
        rownum = rownum + 1;
        FETCH have INTO have_rec;
        have_found := FOUND;
        FETCH want INTO want_rec;
        want_found := FOUND;
    END LOOP;

    perform public.piggly_branch($PIGGLY$a58c7d26b9dc25f0$PIGGLY$);RETURN ok( true, $3 );
EXCEPTION
    WHEN datatype_mismatch THEN
        perform public.piggly_branch($PIGGLY$63c46b5aad3fb2ef$PIGGLY$);
        GET STACKED DIAGNOSTICS err_msg = MESSAGE_TEXT;
        perform public.piggly_branch($PIGGLY$496200be9401a5fc$PIGGLY$);RETURN ok( false, $3 ) || E'\n' || diag(
            E'    Number of columns or their types differ between the queries' ||
            CASE WHEN have_rec::TEXT = want_rec::text THEN '' ELSE E':\n' ||
                '        have: ' || CASE WHEN have_found THEN have_rec::text ELSE 'NULL' END || E'\n' ||
                '        want: ' || CASE WHEN want_found THEN want_rec::text ELSE 'NULL' END
            END || E'\n        ERROR: ' || err_msg
        );
END;